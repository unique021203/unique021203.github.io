<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>lxw的机器学习之旅 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="lxw的机器学习之旅想用tensorflow的框架先实现一个二分类，采用的代码是MINST数据集的手写数字识别。遇到的最大的问题就是需要自制数据集，在此记录一下自制数据集的时候不断遇到问题并解决问题的过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="lxw的机器学习之旅">
<meta property="og:url" content="http://example.com/2022/02/18/lxw%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="lxw的机器学习之旅想用tensorflow的框架先实现一个二分类，采用的代码是MINST数据集的手写数字识别。遇到的最大的问题就是需要自制数据集，在此记录一下自制数据集的时候不断遇到问题并解决问题的过程。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-02-18T04:20:46.000Z">
<meta property="article:modified_time" content="2022-02-18T04:25:54.639Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="实践的第一个踝关节骨折简单二分类">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-lxw的机器学习之旅" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/02/18/lxw%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/" class="article-date">
  <time class="dt-published" datetime="2022-02-18T04:20:46.000Z" itemprop="datePublished">2022-02-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      lxw的机器学习之旅
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="lxw的机器学习之旅"><a href="#lxw的机器学习之旅" class="headerlink" title="lxw的机器学习之旅"></a>lxw的机器学习之旅</h1><p>想用tensorflow的框架先实现一个二分类，采用的代码是MINST数据集的手写数字识别。遇到的最大的问题就是需要自制数据集，在此记录一下自制数据集的时候不断遇到问题并解决问题的过程。</p>
<span id="more"></span>

<h2 id="初始代码"><a href="#初始代码" class="headerlink" title="初始代码"></a>初始代码</h2><p>首先贴一下MINST数据集神经网络训练的初始代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">mnist = tf.keras.datasets.mnist</span><br><span class="line">(x_train, y_train), (x_test, y_test) = mnist.load_data()</span><br><span class="line">x_train, x_test = x_train / <span class="number">255.0</span>, x_test / <span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="literal">False</span>),</span><br><span class="line">              metrics=[<span class="string">&#x27;sparse_categorical_accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, batch_size=<span class="number">32</span>, epochs=<span class="number">5</span>, validation_data=(x_test, y_test), validation_freq=<span class="number">1</span>)</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>

<h2 id="补充自制数据集部分"><a href="#补充自制数据集部分" class="headerlink" title="补充自制数据集部分"></a>补充自制数据集部分</h2><p>下面是补充了自制数据集之后的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">train_path = <span class="string">&#x27;./mnist_image_label/mnist_train_jpg_60000/&#x27;</span></span><br><span class="line">train_txt = <span class="string">&#x27;./mnist_image_label/mnist_train_jpg_60000.txt&#x27;</span></span><br><span class="line">x_train_savepath = <span class="string">&#x27;./mnist_image_label/mnist_x_train.npy&#x27;</span></span><br><span class="line">y_train_savepath = <span class="string">&#x27;./mnist_image_label/mnist_y_train.npy&#x27;</span></span><br><span class="line"></span><br><span class="line">test_path = <span class="string">&#x27;./mnist_image_label/mnist_test_jpg_10000/&#x27;</span></span><br><span class="line">test_txt = <span class="string">&#x27;./mnist_image_label/mnist_test_jpg_10000.txt&#x27;</span></span><br><span class="line">x_test_savepath = <span class="string">&#x27;./mnist_image_label/mnist_x_test.npy&#x27;</span></span><br><span class="line">y_test_savepath = <span class="string">&#x27;./mnist_image_label/mnist_y_test.npy&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateds</span>(<span class="params">path, txt</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(txt, <span class="string">&#x27;r&#x27;</span>)  <span class="comment"># 以只读形式打开txt文件</span></span><br><span class="line">    contents = f.readlines()  <span class="comment"># 读取文件中所有行</span></span><br><span class="line">    f.close()  <span class="comment"># 关闭txt文件</span></span><br><span class="line">    x, y_ = [], []  <span class="comment"># 建立空列表</span></span><br><span class="line">    <span class="keyword">for</span> content <span class="keyword">in</span> contents:  <span class="comment"># 逐行取出</span></span><br><span class="line">        value = content.split()  <span class="comment"># 以空格分开，图片路径为value[0] , 标签为value[1] , 存入列表</span></span><br><span class="line">        img_path = path + value[<span class="number">0</span>]  <span class="comment"># 拼出图片路径和文件名</span></span><br><span class="line">        img = Image.<span class="built_in">open</span>(img_path)  <span class="comment"># 读入图片</span></span><br><span class="line">        img = np.array(img.convert(<span class="string">&#x27;L&#x27;</span>))  <span class="comment"># 图片变为8位宽灰度值的np.array格式</span></span><br><span class="line">        img = img / <span class="number">255.</span>  <span class="comment"># 数据归一化 （实现预处理）</span></span><br><span class="line">        x.append(img)  <span class="comment"># 归一化后的数据，贴到列表x</span></span><br><span class="line">        y_.append(value[<span class="number">1</span>])  <span class="comment"># 标签贴到列表y_</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;loading : &#x27;</span> + content)  <span class="comment"># 打印状态提示</span></span><br><span class="line"></span><br><span class="line">    x = np.array(x)  <span class="comment"># 变为np.array格式</span></span><br><span class="line">    y_ = np.array(y_)  <span class="comment"># 变为np.array格式</span></span><br><span class="line">    y_ = y_.astype(np.int64)  <span class="comment"># 变为64位整型</span></span><br><span class="line">    <span class="keyword">return</span> x, y_  <span class="comment"># 返回输入特征x，返回标签y_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(x_train_savepath) <span class="keyword">and</span> os.path.exists(y_train_savepath) <span class="keyword">and</span> os.path.exists(</span><br><span class="line">        x_test_savepath) <span class="keyword">and</span> os.path.exists(y_test_savepath):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------Load Datasets-----------------&#x27;</span>)</span><br><span class="line">    x_train_save = np.load(x_train_savepath)</span><br><span class="line">    y_train = np.load(y_train_savepath)</span><br><span class="line">    x_test_save = np.load(x_test_savepath)</span><br><span class="line">    y_test = np.load(y_test_savepath)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;len(x_train_save = &quot;</span>, <span class="built_in">len</span>(x_train_save))</span><br><span class="line">    x_train = np.reshape(x_train_save, (<span class="built_in">len</span>(x_train_save), <span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line">    x_test = np.reshape(x_test_save, (<span class="built_in">len</span>(x_test_save), <span class="number">28</span>, <span class="number">28</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------Generate Datasets-----------------&#x27;</span>)</span><br><span class="line">    x_train, y_train = generateds(train_path, train_txt)</span><br><span class="line">    x_test, y_test = generateds(test_path, test_txt)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-------------Save Datasets-----------------&#x27;</span>)</span><br><span class="line">    x_train_save = np.reshape(x_train, (<span class="built_in">len</span>(x_train), -<span class="number">1</span>))</span><br><span class="line">    x_test_save = np.reshape(x_test, (<span class="built_in">len</span>(x_test), -<span class="number">1</span>))</span><br><span class="line">    np.save(x_train_savepath, x_train_save)</span><br><span class="line">    np.save(y_train_savepath, y_train)</span><br><span class="line">    np.save(x_test_savepath, x_test_save)</span><br><span class="line">    np.save(y_test_savepath, y_test)</span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="literal">False</span>),</span><br><span class="line">              metrics=[<span class="string">&#x27;sparse_categorical_accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">model.fit(x_train, y_train, batch_size=<span class="number">32</span>, epochs=<span class="number">5</span>, validation_data=(x_test, y_test), validation_freq=<span class="number">1</span>)</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>

<h2 id="图片名称中的空格转成下划线"><a href="#图片名称中的空格转成下划线" class="headerlink" title="图片名称中的空格转成下划线"></a>图片名称中的空格转成下划线</h2><p>那么我现在手里拿到的只是全部的X光片，存在images文件夹中，都是png格式，正常脚踝的图片命名以ControlGroup开头，骨折脚踝的图片命名以FractureGroup开头，标记出脚踝的图片在命名的末尾添加了Lable。这些其实都是组长的工作成果，目前我还没有学会怎么把.nrrd文件转换成.png文件。</p>
<p>遇到的第一个问题是原来的命名中含有空格，在之后用split()非常不方便，需要先将图片名称中的空格转成下划线，下面的代码可以实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径：D:\Promgramming\AI\tensorflow\trans_space_to_.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">image_dir   = <span class="string">&quot;./images&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_space</span>(<span class="params">buff_dir</span>):</span><br><span class="line">    <span class="keyword">for</span> files_name <span class="keyword">in</span> os.listdir(buff_dir):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(files_name.split(<span class="string">&quot; &quot;</span>)) &gt;<span class="number">1</span>:</span><br><span class="line">            os.rename(os.path.join(buff_dir,files_name),</span><br><span class="line">                      os.path.join(buff_dir,files_name.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;_&quot;</span>)))</span><br><span class="line">            <span class="built_in">print</span>(os.path.join(buff_dir,files_name.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;_&quot;</span>)))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">delete_space(image_dir)</span><br></pre></td></tr></table></figure>

<h2 id="根据文件名称筛选文件"><a href="#根据文件名称筛选文件" class="headerlink" title="根据文件名称筛选文件"></a>根据文件名称筛选文件</h2><p>遇到的下一个问题是我需要将标记出脚踝的正常根骨图片筛选出来，放到right文件夹中；将标记出脚踝的骨折根骨图片筛选出来，放到wrong文件夹中。利用组长的命名规则，使用如下代码可以完成这个工作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径：D:\Promgramming\AI\select.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">src_path = <span class="string">&#x27;D:\创新杯\无损PNG格式的数据集&#x27;</span></span><br><span class="line"></span><br><span class="line">to_path_right = <span class="string">&#x27;D:\\Promgramming\\AI\\right&#x27;</span></span><br><span class="line">to_path_wrong = <span class="string">&#x27;D:\\Promgramming\\AI\\wrong&#x27;</span></span><br><span class="line"></span><br><span class="line">key_right1 = <span class="string">&#x27;ControlGroup&#x27;</span></span><br><span class="line">key_right2 = <span class="string">&#x27;Label&#x27;</span></span><br><span class="line">key_wrong1 = <span class="string">&#x27;FractureGroup&#x27;</span></span><br><span class="line">key_wrong2 = <span class="string">&#x27;Label&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">folder = <span class="string">r&quot;D:\创新杯\无损PNG格式的数据集&quot;</span></span><br><span class="line">files = os.listdir(folder)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file_filter</span>(<span class="params">f</span>):</span><br><span class="line">    <span class="keyword">if</span> key_wrong1 <span class="keyword">in</span> f <span class="keyword">and</span> key_wrong2 <span class="keyword">in</span> f:</span><br><span class="line">        shutil.copy(src_path + <span class="string">&#x27;\\&#x27;</span> + f, to_path_wrong + <span class="string">&#x27;\\&#x27;</span> + f)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">files = <span class="built_in">list</span>(<span class="built_in">filter</span>(file_filter, files))</span><br><span class="line"><span class="built_in">print</span>(files)</span><br></pre></td></tr></table></figure>

<h2 id="生成”图片名-标签“的txt文件"><a href="#生成”图片名-标签“的txt文件" class="headerlink" title="生成”图片名+标签“的txt文件"></a>生成”图片名+标签“的txt文件</h2><p>完成图片分类后要将两个文件夹中的文件以“图片名+标签”的格式打印到一个txt文件中，生成right_list.txt的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径：D:\Promgramming\AI\turn_to_right_list.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params"><span class="built_in">dir</span>,label</span>):</span><br><span class="line">	files = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">	files.sort()</span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&#x27;****************&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&#x27;input :&#x27;</span>,<span class="built_in">dir</span>)</span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&#x27;start...&#x27;</span>)</span><br><span class="line">	listText = <span class="built_in">open</span>(<span class="built_in">dir</span>+<span class="string">&#x27;\\&#x27;</span>+<span class="string">&#x27;right_list.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">	<span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">		fileType = os.path.split(file)</span><br><span class="line">		<span class="keyword">if</span> fileType[<span class="number">1</span>] == <span class="string">&#x27;.txt&#x27;</span>:</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		name = file + <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">int</span>(label)) +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">		listText.write(name)</span><br><span class="line">	listText.close()</span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&#x27;down!&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span> (<span class="string">&#x27;****************&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	generate(<span class="string">&#x27;D:\\Promgramming\\AI\\right&#x27;</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>生成wrong_list.txt同理。</p>
<h2 id="随机打乱list-txt中的信息"><a href="#随机打乱list-txt中的信息" class="headerlink" title="随机打乱list.txt中的信息"></a>随机打乱list.txt中的信息</h2><p>将right_list.txt与wrong_list.txt合并后，可以得到完整的”图片名+标签“的list文件，下一个问题是，一下子喂入所有骨折再喂入正常的进行训练，训练效果一定会大打折扣，下面的代码实现了将list.txt中的信息随机打乱。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径：D:\Promgramming\AI\tensorflow\random_list.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">out = <span class="built_in">open</span>(<span class="string">&quot;./random_list.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">lines=[]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./list.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> infile:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> infile:</span><br><span class="line">        lines.append(line)</span><br><span class="line">random.shuffle(lines)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    out.write(line) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;done&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>打乱之后得到的random_list.txt部分如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">FractureGroup_174_GR_Label.png 1</span><br><span class="line">ControlGroup_151_F_Label.png 0</span><br><span class="line">ControlGroup_74_C_Label.png 0</span><br><span class="line">FractureGroup_43_B_Label.png 1</span><br><span class="line">FractureGroup_52_C_Label.png 1</span><br><span class="line">FractureGroup_212_K_Label.png 1</span><br><span class="line">FractureGroup_97_D_Label.png 1</span><br><span class="line">ControlGroup_91_D_Label.png 0</span><br><span class="line">ControlGroup_89_D_Label.png 0</span><br><span class="line">FractureGroup_237_Y_Label.png 1</span><br><span class="line">FractureGroup_145_F_Label.png 1</span><br><span class="line">FractureGroup_252_Y_Label.png 1</span><br><span class="line">FractureGroup_74_C_Label.png 1</span><br><span class="line">FractureGroup_5_N_Label.png 1</span><br><span class="line">FractureGroup_250_Y_Label.png 1</span><br><span class="line">FractureGroup_213_K_Label.png 1</span><br><span class="line">FractureGroup_113_F_Label.png 1</span><br><span class="line">ControlGroup_149_F_Label.png 0</span><br><span class="line">FractureGroup_55_CR_Label.png 1</span><br><span class="line">ControlGroup_18_N_Label.png 0</span><br><span class="line">ControlGroup_61_C_Label.png 0</span><br><span class="line">FractureGroup_27_B_Label.png 1</span><br><span class="line">FractureGroup_189_K_Label.png 1</span><br><span class="line">ControlGroup_114_F_Label.png 0</span><br><span class="line">ControlGroup_147_F_Label.png 0</span><br><span class="line">FractureGroup_225_Y_Label.png 1</span><br><span class="line">ControlGroup_9_N_Label.png 0</span><br><span class="line">ControlGroup_152_F_Label.png 0</span><br><span class="line">FractureGroup_32_B_Label.png 1</span><br><span class="line">FractureGroup_220_K_Label.png 1</span><br><span class="line">ControlGroup_98_D_Label.png 0</span><br><span class="line">ControlGroup_60_C_Label.png 0</span><br><span class="line">FractureGroup_139_F_Label.png 1</span><br></pre></td></tr></table></figure>

<h2 id="给出所有文件名筛选文件"><a href="#给出所有文件名筛选文件" class="headerlink" title="给出所有文件名筛选文件"></a>给出所有文件名筛选文件</h2><p>一共446个文件，$4&#x2F;5$用于train，$1&#x2F;5$用于test，把完成的list截断后，需要根据train_list.txt和wrong_list.txt将images中的文件分到train和test两个文件夹中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件路径：D:\Promgramming\AI\select.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">oldpath = <span class="string">r&#x27;D:\Promgramming\AI\tensorflow\images&#x27;</span></span><br><span class="line">newpath = <span class="string">r&#x27;D:\Promgramming\AI\tensorflow\test&#x27;</span></span><br><span class="line">file_path = <span class="string">r&#x27;D:\Promgramming\AI\tensorflow\test_list.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从文件中获取要拷贝的文件的信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_filename_from_txt</span>(<span class="params">file</span>):</span><br><span class="line">    filename_lists = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lists =  f.readlines()</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">list</span> <span class="keyword">in</span> lists:</span><br><span class="line">            value = <span class="built_in">list</span>.split()</span><br><span class="line">            filename_lists.append(<span class="built_in">str</span>(value[<span class="number">0</span>]).strip(<span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> filename_lists</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝文件到新的文件夹中</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mycopy</span>(<span class="params">srcpath,dstpath,filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(srcpath):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;srcpath not exist!&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dstpath):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;dstpath not exist!&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> root,dirs,files <span class="keyword">in</span> os.walk(srcpath,<span class="literal">True</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">in</span> files:</span><br><span class="line">            <span class="comment"># 如果存在就拷贝</span></span><br><span class="line">            shutil.copy(os.path.join(root,filename),dstpath)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 不存在的话将文件信息打印出来</span></span><br><span class="line">            <span class="built_in">print</span>(filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#执行获取文件信息的程序</span></span><br><span class="line">    filename_lists = get_filename_from_txt(file_path)</span><br><span class="line">    <span class="comment">#根据获取的信息进行遍历输出</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filename_lists:</span><br><span class="line">        mycopy(oldpath,newpath,filename)</span><br></pre></td></tr></table></figure>

<p>至此准备工作就已经完成了。</p>
<h2 id="图像预处理PAD"><a href="#图像预处理PAD" class="headerlink" title="图像预处理PAD"></a>图像预处理PAD</h2><p>2月12号遇到的问题主要是图像预处理的部分，由于利用model.fit()进行训练时需要喂入shape相同的array，而拿到的图片大小都不同，比例也不同，脚踝所在的位置也不同。</p>
<p>思考后想通过numpy.pad函数进行边缘填充，将图片都填充成3100*3100，尝试之后发现自制数据集达到了35G，最后因为GPU显存不足已经开始的训练被迫中止，代码似乎是没有问题了，可以先用resize()压缩成31*31试一下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pad填充成3000*3000</span></span><br><span class="line">img = np.pad(img, ((standard_size - img.shape[<span class="number">0</span>], <span class="number">0</span>), (standard_size - img.shape[<span class="number">1</span>], <span class="number">0</span>)), <span class="string">&#x27;edge&#x27;</span>)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/02/18/lxw%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/" data-id="ckzrwtcxd000080vt3vp06i95" data-title="lxw的机器学习之旅" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%9E%E8%B7%B5%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%B8%9D%E5%85%B3%E8%8A%82%E9%AA%A8%E6%8A%98%E7%AE%80%E5%8D%95%E4%BA%8C%E5%88%86%E7%B1%BB/" rel="tag">实践的第一个踝关节骨折简单二分类</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/03/16/Lab%200/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2022/02/18/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%9E%E8%B7%B5%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%B8%9D%E5%85%B3%E8%8A%82%E9%AA%A8%E6%8A%98%E7%AE%80%E5%8D%95%E4%BA%8C%E5%88%86%E7%B1%BB/" rel="tag">实践的第一个踝关节骨折简单二分类</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%AE%9E%E8%B7%B5%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%B8%9D%E5%85%B3%E8%8A%82%E9%AA%A8%E6%8A%98%E7%AE%80%E5%8D%95%E4%BA%8C%E5%88%86%E7%B1%BB/" style="font-size: 10px;">实践的第一个踝关节骨折简单二分类</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/03/16/Lab%200/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/02/18/lxw%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/">lxw的机器学习之旅</a>
          </li>
        
          <li>
            <a href="/2022/02/18/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>